(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[278],{5425:(e,t,a)=>{"use strict";a.d(t,{Bc:()=>i,ZI:()=>c,k$:()=>o,m_:()=>d});var s=a(26027),r=a(57307),l=a(56334),n=a(86383);let i=l.Kq,d=l.bL,o=l.l9,c=r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...i}=e;return(0,s.jsx)(l.UC,{ref:t,sideOffset:r,className:(0,n.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...i})});c.displayName=l.UC.displayName},35420:(e,t,a)=>{"use strict";a.d(t,{p:()=>n});var s=a(26027),r=a(57307),l=a(86383);let n=r.forwardRef((e,t)=>{let{className:a,type:r,...n}=e;return(0,s.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...n})});n.displayName="Input"},40722:(e,t,a)=>{"use strict";a.d(t,{T:()=>n});var s=a(26027),r=a(57307),l=a(86383);let n=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...r})});n.displayName="Textarea"},45506:(e,t,a)=>{Promise.resolve().then(a.bind(a,63958))},52560:(e,t,a)=>{"use strict";a.d(t,{$:()=>o});var s=a(26027),r=a(57307),l=a(45415),n=a(96084),i=a(86383);let d=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=r.forwardRef((e,t)=>{let{className:a,variant:r,size:n,asChild:o=!1,...c}=e,m=o?l.Slot:"button";return(0,s.jsx)(m,{className:(0,i.cn)(d({variant:r,size:n,className:a})),ref:t,...c})});o.displayName="Button"},59586:(e,t,a)=>{"use strict";a.d(t,{BT:()=>o,Wu:()=>c,ZB:()=>d,Zp:()=>n,aR:()=>i,wL:()=>m});var s=a(26027),r=a(57307),l=a(86383);let n=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...r})});n.displayName="Card";let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",a),...r})});i.displayName="CardHeader";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",a),...r})});d.displayName="CardTitle";let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...r})});o.displayName="CardDescription";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",a),...r})});c.displayName="CardContent";let m=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",a),...r})});m.displayName="CardFooter"},63958:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>W});var s=a(26027),r=a(57307),l=a(9753),n=a(52560),i=a(59586),d=a(35420),o=a(83226),c=a(75976),m=a(40722),u=a(48475),p=a(98787),f=a(65860),x=a(78695),h=a(26593),g=a(95774),b=a(45684),y=a.n(b),v=a(75051),j=a(86696),N=a(5425),w=a(77489),k=a(96084),_=a(86383);let P=(0,k.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),C=r.forwardRef((e,t)=>{let{className:a,variant:r,...l}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:(0,_.cn)(P({variant:r}),a),...l})});C.displayName="Alert",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("h5",{ref:t,className:(0,_.cn)("mb-1 font-medium leading-none tracking-tight",a),...r})}).displayName="AlertTitle";let R=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,_.cn)("text-sm [&_p]:leading-relaxed",a),...r})});R.displayName="AlertDescription";var S=a(98104);let D=S.bL,L=S.l9,I=r.forwardRef((e,t)=>{let{className:a,align:r="center",sideOffset:l=4,...n}=e;return(0,s.jsx)(S.ZL,{children:(0,s.jsx)(S.UC,{ref:t,align:r,sideOffset:l,className:(0,_.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})})});I.displayName=S.UC.displayName;var F=a(57315),A=a(32702),q=a(81722),T=a(61138);q.bL,q.l9;let B=q.ZL;q.bm;let E=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(q.hJ,{ref:t,className:(0,_.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r})});E.displayName=q.hJ.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,s.jsxs)(B,{children:[(0,s.jsx)(E,{}),(0,s.jsxs)(q.UC,{ref:t,className:(0,_.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...l,children:[r,(0,s.jsxs)(q.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(T.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}).displayName=q.UC.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(q.hE,{ref:t,className:(0,_.cn)("text-lg font-semibold leading-none tracking-tight",a),...r})}).displayName=q.hE.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(q.VY,{ref:t,className:(0,_.cn)("text-sm text-muted-foreground",a),...r})}).displayName=q.VY.displayName;let z=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(F.uB,{ref:t,className:(0,_.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",a),...r})});z.displayName=F.uB.displayName;let J=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsxs)("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[(0,s.jsx)(A.A,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,s.jsx)(F.uB.Input,{ref:t,className:(0,_.cn)("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",a),...r})]})});J.displayName=F.uB.Input.displayName;let Z=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(F.uB.List,{ref:t,className:(0,_.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",a),...r})});Z.displayName=F.uB.List.displayName;let V=r.forwardRef((e,t)=>(0,s.jsx)(F.uB.Empty,{ref:t,className:"py-6 text-center text-sm",...e}));V.displayName=F.uB.Empty.displayName;let U=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(F.uB.Group,{ref:t,className:(0,_.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",a),...r})});U.displayName=F.uB.Group.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(F.uB.Separator,{ref:t,className:(0,_.cn)("-mx-1 h-px bg-border",a),...r})}).displayName=F.uB.Separator.displayName;let $=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(F.uB.Item,{ref:t,className:(0,_.cn)("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a),...r})});$.displayName=F.uB.Item.displayName;var X=a(83418);let O=[{id:1,name:"均线交叉策略"},{id:2,name:"动量反转策略"},{id:3,name:"波动率突破策略"},{id:4,name:"季节性交易策略"},{id:5,name:"基本面筛选策略"}],M={1:[{name:"short_ma_period",label:"短期均线周期",type:"number",default:10,description:"短期移动平均线的周期",required:!0,min:2,max:100,step:1},{name:"long_ma_period",label:"长期均线周期",type:"number",default:50,description:"长期移动平均线的周期",required:!0,min:10,max:200,step:1},{name:"position_size",label:"仓位大小",type:"number",default:100,description:"每次交易的股数",required:!0,min:1,max:1e4,step:1},{name:"use_trailing_stop",label:"使用追踪止损",type:"boolean",default:!1,description:"是否启用追踪止损功能"},{name:"trailing_stop_pct",label:"追踪止损百分比",type:"number",default:5,description:"追踪止损的百分比距离",required:!0,min:.1,max:20,step:.1,depends_on:{param:"use_trailing_stop",value:!0}},{name:"signal_type",label:"信号类型",type:"select",default:"cross",description:"选择使用的信号类型",options:[{value:"cross",label:"均线交叉"},{value:"above",label:"价格在均线之上"},{value:"below",label:"价格在均线之下"}]}],2:[{name:"lookback_period",label:"回溯周期",type:"number",default:20,description:"计算动量的回溯周期",required:!0,min:5,max:100,step:1},{name:"threshold",label:"反转阈值",type:"number",default:2,description:"触发反转信号的标准差倍数",required:!0,min:.5,max:5,step:.1},{name:"holding_period",label:"持有周期",type:"number",default:5,description:"持有头寸的天数",required:!0,min:1,max:30,step:1}],3:[{name:"volatility_period",label:"波动率周期",type:"number",default:20,description:"计算波动率的周期",required:!0,min:5,max:100,step:1},{name:"breakout_multiplier",label:"突破倍数",type:"number",default:2.5,description:"突破信号的波动率倍数",required:!0,min:.5,max:5,step:.1},{name:"exit_multiplier",label:"退出倍数",type:"number",default:1,description:"退出信号的波动率倍数",required:!0,min:.1,max:3,step:.1}],4:[{name:"month_to_buy",label:"买入月份",type:"number",default:11,description:"买入的月份 (1-12)",required:!0,min:1,max:12,step:1},{name:"month_to_sell",label:"卖出月份",type:"number",default:4,description:"卖出的月份 (1-12)",required:!0,min:1,max:12,step:1},{name:"day_of_month_to_buy",label:"买入日",type:"number",default:1,description:"买入的日期 (1-31)",required:!0,min:1,max:31,step:1},{name:"day_of_month_to_sell",label:"卖出日",type:"number",default:30,description:"卖出的日期 (1-31)",required:!0,min:1,max:31,step:1}],5:[{name:"min_pe_ratio",label:"最小PE比率",type:"number",default:5,description:"最小市盈率",required:!0,min:0,max:100,step:.1},{name:"max_pe_ratio",label:"最大PE比率",type:"number",default:20,description:"最大市盈率",required:!0,min:0,max:100,step:.1},{name:"min_market_cap",label:"最小市值(百万)",type:"number",default:1e3,description:"最小市值(百万美元)",required:!0,min:0,max:1e6,step:100},{name:"min_dividend_yield",label:"最小股息率(%)",type:"number",default:2,description:"最小股息率百分比",required:!0,min:0,max:20,step:.1}]},Q=[{symbol:"SPY",name:"SPDR S&P 500 ETF Trust"},{symbol:"QQQ",name:"Invesco QQQ Trust"},{symbol:"AAPL",name:"Apple Inc."},{symbol:"MSFT",name:"Microsoft Corporation"},{symbol:"AMZN",name:"Amazon.com, Inc."},{symbol:"GOOGL",name:"Alphabet Inc."},{symbol:"META",name:"Meta Platforms, Inc."},{symbol:"TSLA",name:"Tesla, Inc."},{symbol:"XLF",name:"Financial Select Sector SPDR Fund"},{symbol:"XLE",name:"Energy Select Sector SPDR Fund"},{symbol:"XLK",name:"Technology Select Sector SPDR Fund"},{symbol:"XLV",name:"Health Care Select Sector SPDR Fund"},{symbol:"XLY",name:"Consumer Discretionary Select Sector SPDR Fund"},{symbol:"XLP",name:"Consumer Staples Select Sector SPDR Fund"},{symbol:"XLI",name:"Industrial Select Sector SPDR Fund"},{symbol:"XLB",name:"Materials Select Sector SPDR Fund"},{symbol:"XLU",name:"Utilities Select Sector SPDR Fund"},{symbol:"XLRE",name:"Real Estate Select Sector SPDR Fund"},{symbol:"XLC",name:"Communication Services Select Sector SPDR Fund"},{symbol:"IWM",name:"iShares Russell 2000 ETF"}];function W(){var e,t;let a=(0,l.useRouter)(),b=(0,l.useSearchParams)().get("strategyId"),[k,P]=(0,r.useState)({name:"",strategyId:b||"",symbol:"",startDate:"2020-01-01",endDate:"2024-12-31",initialCapital:1e4,commissionRate:.1,slippageRate:.05,useStopLoss:!1,stopLossPercent:2,useTakeProfit:!1,takeProfitPercent:6,description:"",strategyParameters:{}}),[S,F]=(0,r.useState)([]),[A,q]=(0,r.useState)({}),[T,B]=(0,r.useState)(!1),[E,W]=(0,r.useState)(!1);(0,r.useEffect)(()=>{k.strategyId?(B(!0),setTimeout(()=>{let e=M[k.strategyId]||[];F(e);let t={};e.forEach(e=>{t[e.name]=e.default}),P(e=>({...e,strategyParameters:t})),B(!1)},500)):(F([]),P(e=>({...e,strategyParameters:{}})))},[k.strategyId]);let Y=(e,t)=>{P(a=>({...a,strategyParameters:{...a.strategyParameters,[e]:t}})),A.strategyParameters&&A.strategyParameters[e]&&q(t=>{let a={...t.strategyParameters};return delete a[e],{...t,strategyParameters:a}})},G=()=>{let e={};k.name.trim()||(e.name="回测名称不能为空"),k.strategyId||(e.strategyId="请选择策略"),k.symbol||(e.symbol="请选择交易品种");let t=new Date(k.startDate),a=new Date(k.endDate);if(isNaN(t.getTime())&&(e.startDate="请输入有效的开始日期"),isNaN(a.getTime())?e.endDate="请输入有效的结束日期":a<=t&&(e.endDate="结束日期必须晚于开始日期"),k.initialCapital<=0&&(e.initialCapital="初始资金必须大于0"),S.length>0){let t={};S.forEach(e=>{if((!e.depends_on||k.strategyParameters[e.depends_on.param]===e.depends_on.value)&&e.required){let a=k.strategyParameters[e.name];if(null==a||""===a)t[e.name]="".concat(e.label,"不能为空");else if("number"===e.type){let s=Number(a);isNaN(s)?t[e.name]="".concat(e.label,"必须是数字"):void 0!==e.min&&s<e.min?t[e.name]="".concat(e.label,"不能小于").concat(e.min):void 0!==e.max&&s>e.max&&(t[e.name]="".concat(e.label,"不能大于").concat(e.max))}}}),Object.keys(t).length>0&&(e.strategyParameters=t)}return q(e),0===Object.keys(e).length},H=e=>{if(e.preventDefault(),!G()){let e=document.querySelector(".error-message");e&&e.scrollIntoView({behavior:"smooth",block:"center"});return}console.log("提交回测表单:",{backtest_name:k.name,strategy_id:Number.parseInt(k.strategyId),symbols:[k.symbol],start_date:k.startDate,end_date:k.endDate,description:k.description,initial_capital:k.initialCapital,advanced_settings:{commission_rate:k.commissionRate,slippage_rate:k.slippageRate,use_stop_loss:k.useStopLoss,stop_loss_percent:k.stopLossPercent,use_take_profit:k.useTakeProfit,take_profit_percent:k.takeProfitPercent},strategy_params:k.strategyParameters}),a.push("/backtests")},K=e=>!e.depends_on||k.strategyParameters[e.depends_on.param]===e.depends_on.value;return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(y(),{href:"/backtests",children:(0,s.jsxs)(n.$,{variant:"ghost",size:"sm",children:[(0,s.jsx)(u.A,{className:"h-4 w-4 mr-1"}),"返回"]})}),(0,s.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"创建回测"})]}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"配置回测参数，评估您的交易策略表现"})]}),(0,s.jsxs)(n.$,{onClick:H,children:[(0,s.jsx)(p.A,{className:"mr-2 h-4 w-4"})," 开始回测"]})]}),(0,s.jsx)("form",{onSubmit:H,children:(0,s.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,s.jsxs)(i.Zp,{children:[(0,s.jsxs)(i.aR,{children:[(0,s.jsx)(i.ZB,{children:"基本信息"}),(0,s.jsx)(i.BT,{children:"设置回测的基本参数"})]}),(0,s.jsxs)(i.Wu,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{htmlFor:"name",className:A.name?"text-destructive":"",children:"回测名称"}),(0,s.jsx)(d.p,{id:"name",placeholder:"输入回测名称",value:k.name,onChange:e=>{P({...k,name:e.target.value}),A.name&&q({...A,name:void 0})},className:A.name?"border-destructive":"",required:!0}),A.name&&(0,s.jsx)("p",{className:"text-sm text-destructive error-message",children:A.name})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{htmlFor:"strategy",className:A.strategyId?"text-destructive":"",children:"选择策略"}),(0,s.jsxs)(c.l6,{value:k.strategyId.toString(),onValueChange:e=>{P({...k,strategyId:e}),A.strategyId&&q({...A,strategyId:void 0})},required:!0,children:[(0,s.jsx)(c.bq,{className:A.strategyId?"border-destructive":"",children:(0,s.jsx)(c.yv,{placeholder:"选择交易策略"})}),(0,s.jsx)(c.gC,{children:O.map(e=>(0,s.jsx)(c.eb,{value:e.id.toString(),children:e.name},e.id))})]}),A.strategyId&&(0,s.jsx)("p",{className:"text-sm text-destructive error-message",children:A.strategyId})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{htmlFor:"symbol",className:A.symbol?"text-destructive":"",children:"交易品种"}),(0,s.jsxs)(D,{open:E,onOpenChange:W,children:[(0,s.jsx)(L,{asChild:!0,children:(0,s.jsxs)(n.$,{variant:"outline",role:"combobox","aria-expanded":E,className:(0,_.cn)("w-full justify-between",!k.symbol&&"text-muted-foreground",A.symbol&&"border-destructive"),children:[k.symbol?(null===(e=Q.find(e=>e.symbol===k.symbol))||void 0===e?void 0:e.symbol)||k.symbol:"选择交易品种",(0,s.jsx)(X.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,s.jsx)(I,{className:"w-full p-0",children:(0,s.jsxs)(z,{children:[(0,s.jsx)(J,{placeholder:"搜索交易品种..."}),(0,s.jsxs)(Z,{children:[(0,s.jsx)(V,{children:"未找到匹配的交易品种"}),(0,s.jsx)(U,{className:"max-h-60 overflow-auto",children:Q.map(e=>(0,s.jsxs)($,{value:e.symbol,onSelect:e=>{P({...k,symbol:e}),A.symbol&&q({...A,symbol:void 0}),W(!1)},children:[(0,s.jsx)(X.A,{className:(0,_.cn)("mr-2 h-4 w-4",k.symbol===e.symbol?"opacity-100":"opacity-0")}),e.symbol," - ",e.name]},e.symbol))})]})]})})]}),A.symbol&&(0,s.jsx)("p",{className:"text-sm text-destructive error-message",children:A.symbol})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{htmlFor:"startDate",className:A.startDate?"text-destructive":"",children:"开始日期"}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(f.A,{className:"mr-2 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(d.p,{id:"startDate",type:"date",value:k.startDate,onChange:e=>{P({...k,startDate:e.target.value}),A.startDate&&q({...A,startDate:void 0})},className:A.startDate?"border-destructive":"",required:!0})]}),A.startDate&&(0,s.jsx)("p",{className:"text-sm text-destructive error-message",children:A.startDate})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{htmlFor:"endDate",className:A.endDate?"text-destructive":"",children:"结束日期"}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(f.A,{className:"mr-2 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(d.p,{id:"endDate",type:"date",value:k.endDate,onChange:e=>{P({...k,endDate:e.target.value}),A.endDate&&q({...A,endDate:void 0})},className:A.endDate?"border-destructive":"",required:!0})]}),A.endDate&&(0,s.jsx)("p",{className:"text-sm text-destructive error-message",children:A.endDate})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{htmlFor:"description",children:"回测描述"}),(0,s.jsx)(m.T,{id:"description",placeholder:"输入回测描述（可选）",value:k.description,onChange:e=>P({...k,description:e.target.value}),rows:3})]})]})]}),k.strategyId&&(0,s.jsxs)(i.Zp,{children:[(0,s.jsxs)(i.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.ZB,{children:"策略参数配置"}),(0,s.jsxs)(i.BT,{children:['配置 "',null===(t=O.find(e=>e.id.toString()===k.strategyId))||void 0===t?void 0:t.name,'" 的参数']})]}),(0,s.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>{let e={};S.forEach(t=>{e[t.name]=t.default}),P(t=>({...t,strategyParameters:e})),A.strategyParameters&&q(e=>({...e,strategyParameters:{}}))},disabled:T,children:[(0,s.jsx)(x.A,{className:"mr-2 h-4 w-4"}),"恢复默认值"]})]}),(0,s.jsx)(i.Wu,{className:"pt-4",children:T?(0,s.jsxs)("div",{className:"flex justify-center items-center py-8",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),(0,s.jsx)("span",{className:"ml-2",children:"加载参数中..."})]}):0===S.length?(0,s.jsxs)(C,{children:[(0,s.jsx)(h.A,{className:"h-4 w-4"}),(0,s.jsx)(R,{children:"该策略没有可配置的参数"})]}):(0,s.jsx)("div",{className:"grid gap-4 sm:grid-cols-1 md:grid-cols-2",children:S.map(e=>{var t,a,r,l,n;return K(e)&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(o.J,{htmlFor:e.name,className:(null===(t=A.strategyParameters)||void 0===t?void 0:t[e.name])?"text-destructive":"",children:[e.label,e.required&&(0,s.jsx)("span",{className:"text-destructive ml-1",children:"*"})]}),(0,s.jsx)(N.Bc,{children:(0,s.jsxs)(N.m_,{children:[(0,s.jsx)(N.k$,{asChild:!0,children:(0,s.jsx)(g.A,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),(0,s.jsxs)(N.ZI,{children:[(0,s.jsx)("p",{children:e.description}),"number"===e.type&&(0,s.jsxs)("p",{className:"text-xs mt-1",children:["范围: ",e.min," - ",e.max,", 步长: ",e.step]})]})]})})]}),"boolean"===e.type?(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(j.d,{id:e.name,checked:k.strategyParameters[e.name]||!1,onCheckedChange:t=>Y(e.name,t)}),(0,s.jsx)(o.J,{htmlFor:e.name,children:k.strategyParameters[e.name]?"启用":"禁用"}),(0,s.jsxs)(w.E,{variant:"outline",className:"ml-auto",children:["默认: ",e.default?"启用":"禁用"]})]}):"number"===e.type?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(d.p,{id:e.name,type:"number",value:k.strategyParameters[e.name]||e.default,onChange:t=>Y(e.name,Number.parseFloat(t.target.value)),min:e.min,max:e.max,step:e.step,className:(0,_.cn)("w-full",(null===(a=A.strategyParameters)||void 0===a?void 0:a[e.name])&&"border-destructive")}),(0,s.jsxs)(w.E,{variant:"outline",children:["默认: ",e.default]})]}),void 0!==e.min&&void 0!==e.max&&(0,s.jsx)(v.A,{id:"".concat(e.name,"-slider"),min:e.min,max:e.max,step:e.step,value:[k.strategyParameters[e.name]||e.default],onValueChange:t=>Y(e.name,t[0])})]}):"select"===e.type?(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)(c.l6,{value:k.strategyParameters[e.name]||e.default,onValueChange:t=>Y(e.name,t),children:[(0,s.jsx)(c.bq,{className:"w-full",children:(0,s.jsx)(c.yv,{placeholder:"选择选项"})}),(0,s.jsx)(c.gC,{children:e.options.map(e=>(0,s.jsx)(c.eb,{value:e.value,children:e.label},e.value))})]}),(0,s.jsxs)(w.E,{variant:"outline",children:["默认: ",null===(r=e.options.find(t=>t.value===e.default))||void 0===r?void 0:r.label]})]}):(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(d.p,{id:e.name,type:"text",value:k.strategyParameters[e.name]||e.default,onChange:t=>Y(e.name,t.target.value),className:(0,_.cn)("w-full",(null===(l=A.strategyParameters)||void 0===l?void 0:l[e.name])&&"border-destructive")}),(0,s.jsxs)(w.E,{variant:"outline",children:["默认: ",e.default]})]}),(null===(n=A.strategyParameters)||void 0===n?void 0:n[e.name])&&(0,s.jsx)("p",{className:"text-sm text-destructive error-message",children:A.strategyParameters[e.name]})]},e.name)})})})]}),(0,s.jsxs)(i.Zp,{children:[(0,s.jsxs)(i.aR,{children:[(0,s.jsx)(i.ZB,{children:"高级设置"}),(0,s.jsx)(i.BT,{children:"配置回测的高级参数"})]}),(0,s.jsxs)(i.Wu,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{htmlFor:"initialCapital",className:A.initialCapital?"text-destructive":"",children:"初始资金 (USD)"}),(0,s.jsx)(d.p,{id:"initialCapital",type:"number",min:"1000",value:k.initialCapital,onChange:e=>{P({...k,initialCapital:Number(e.target.value)}),A.initialCapital&&q({...A,initialCapital:void 0})},className:A.initialCapital?"border-destructive":"",required:!0}),A.initialCapital&&(0,s.jsx)("p",{className:"text-sm text-destructive error-message",children:A.initialCapital})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{htmlFor:"commissionRate",children:"手续费率 (%)"}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(v.A,{id:"commissionRate",min:0,max:1,step:.01,value:[k.commissionRate],onValueChange:e=>P({...k,commissionRate:e[0]})}),(0,s.jsxs)("span",{className:"w-12 text-right",children:[k.commissionRate,"%"]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{htmlFor:"slippageRate",children:"滑点率 (%)"}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(v.A,{id:"slippageRate",min:0,max:1,step:.01,value:[k.slippageRate],onValueChange:e=>P({...k,slippageRate:e[0]})}),(0,s.jsxs)("span",{className:"w-12 text-right",children:[k.slippageRate,"%"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"space-y-0.5",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(o.J,{htmlFor:"useStopLoss",children:"启用止损"}),(0,s.jsx)(N.Bc,{children:(0,s.jsxs)(N.m_,{children:[(0,s.jsx)(N.k$,{asChild:!0,children:(0,s.jsx)(g.A,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),(0,s.jsxs)(N.ZI,{children:[(0,s.jsx)("p",{children:"这是回测引擎提供的全局止损功能，当亏损达到设定比例时自动平仓。"}),(0,s.jsx)("p",{children:"与策略内部的止损逻辑无关。"})]})]})})]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"当亏损达到设定比例时自动平仓"})]}),(0,s.jsx)(j.d,{id:"useStopLoss",checked:k.useStopLoss,onCheckedChange:e=>P({...k,useStopLoss:e})})]}),k.useStopLoss&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{htmlFor:"stopLossPercent",children:"止损比例 (%)"}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(v.A,{id:"stopLossPercent",min:1,max:20,step:.5,value:[k.stopLossPercent],onValueChange:e=>P({...k,stopLossPercent:e[0]})}),(0,s.jsxs)("span",{className:"w-12 text-right",children:[k.stopLossPercent,"%"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"space-y-0.5",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(o.J,{htmlFor:"useTakeProfit",children:"启用止盈"}),(0,s.jsx)(N.Bc,{children:(0,s.jsxs)(N.m_,{children:[(0,s.jsx)(N.k$,{asChild:!0,children:(0,s.jsx)(g.A,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),(0,s.jsxs)(N.ZI,{children:[(0,s.jsx)("p",{children:"这是回测引擎提供的全局止盈功能，当盈利达到设定比例时自动平仓。"}),(0,s.jsx)("p",{children:"与策略内部的止盈逻辑无关。"})]})]})})]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"当盈利达到设定比例时自动平仓"})]}),(0,s.jsx)(j.d,{id:"useTakeProfit",checked:k.useTakeProfit,onCheckedChange:e=>P({...k,useTakeProfit:e})})]}),k.useTakeProfit&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{htmlFor:"takeProfitPercent",children:"止盈比例 (%)"}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(v.A,{id:"takeProfitPercent",min:1,max:50,step:.5,value:[k.takeProfitPercent],onValueChange:e=>P({...k,takeProfitPercent:e[0]})}),(0,s.jsxs)("span",{className:"w-12 text-right",children:[k.takeProfitPercent,"%"]})]})]})]}),(0,s.jsxs)(i.wL,{className:"flex justify-between",children:[(0,s.jsx)(n.$,{variant:"outline",type:"button",onClick:()=>a.push("/backtests"),children:"取消"}),(0,s.jsx)(n.$,{type:"submit",children:"开始回测"})]})]})]})})]})}},75051:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var s=a(26027),r=a(57307),l=a(84757),n=a(86383);let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsxs)(l.bL,{ref:t,className:(0,n.cn)("relative flex w-full touch-none select-none items-center",a),...r,children:[(0,s.jsx)(l.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,s.jsx)(l.Q6,{className:"absolute h-full bg-primary"})}),(0,s.jsx)(l.zi,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});i.displayName=l.bL.displayName},75976:(e,t,a)=>{"use strict";a.d(t,{bq:()=>u,eb:()=>h,gC:()=>x,l6:()=>c,yv:()=>m});var s=a(26027),r=a(57307),l=a(43087),n=a(6112),i=a(86425),d=a(83418),o=a(86383);let c=l.bL;l.YJ;let m=l.WT,u=r.forwardRef((e,t)=>{let{className:a,children:r,...i}=e;return(0,s.jsxs)(l.l9,{ref:t,className:(0,o.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...i,children:[r,(0,s.jsx)(l.In,{asChild:!0,children:(0,s.jsx)(n.A,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=l.l9.displayName;let p=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.PP,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,s.jsx)(i.A,{className:"h-4 w-4"})})});p.displayName=l.PP.displayName;let f=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.wn,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,s.jsx)(n.A,{className:"h-4 w-4"})})});f.displayName=l.wn.displayName;let x=r.forwardRef((e,t)=>{let{className:a,children:r,position:n="popper",...i}=e;return(0,s.jsx)(l.ZL,{children:(0,s.jsxs)(l.UC,{ref:t,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:n,...i,children:[(0,s.jsx)(p,{}),(0,s.jsx)(l.LM,{className:(0,o.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,s.jsx)(f,{})]})})});x.displayName=l.UC.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.JU,{ref:t,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...r})}).displayName=l.JU.displayName;let h=r.forwardRef((e,t)=>{let{className:a,children:r,...n}=e;return(0,s.jsxs)(l.q7,{ref:t,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(l.VF,{children:(0,s.jsx)(d.A,{className:"h-4 w-4"})})}),(0,s.jsx)(l.p4,{children:r})]})});h.displayName=l.q7.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.wv,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=l.wv.displayName},77489:(e,t,a)=>{"use strict";a.d(t,{E:()=>i});var s=a(26027);a(57307);var r=a(96084),l=a(86383);let n=(0,r.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:a,...r}=e;return(0,s.jsx)("div",{className:(0,l.cn)(n({variant:a}),t),...r})}},83226:(e,t,a)=>{"use strict";a.d(t,{J:()=>o});var s=a(26027),r=a(57307),l=a(64184),n=a(96084),i=a(86383);let d=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.b,{ref:t,className:(0,i.cn)(d(),a),...r})});o.displayName=l.b.displayName},86383:(e,t,a)=>{"use strict";a.d(t,{cn:()=>l});var s=a(30050),r=a(86011);function l(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,s.$)(t))}},86696:(e,t,a)=>{"use strict";a.d(t,{d:()=>i});var s=a(26027),r=a(57307),l=a(18824),n=a(86383);let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.bL,{className:(0,n.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...r,ref:t,children:(0,s.jsx)(l.zi,{className:(0,n.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});i.displayName=l.bL.displayName}},e=>{var t=t=>e(e.s=t);e.O(0,[720,684,479,70,22,910,550,545,80,358],()=>t(45506)),_N_E=e.O()}]);